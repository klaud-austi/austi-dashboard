<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Task Board</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{--bg:#0d1117;--surface:#161b22;--border:#30363d;--text:#e6edf3;--text2:#8b949e;--blue:#1f6feb;--green:#238636;--purple:#8957e5;--orange:#d29922;--red:#f85149}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Helvetica,Arial,sans-serif;background:var(--bg);color:var(--text);min-height:100vh}
header{padding:16px 24px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:12px}
header h1{font-size:20px;font-weight:600}
.stats{display:flex;gap:16px;font-size:13px;color:var(--text2)}
.stats span{display:flex;align-items:center;gap:4px}
.dot{width:8px;height:8px;border-radius:50%;display:inline-block}
.board{display:flex;gap:16px;padding:20px 24px;overflow-x:auto;min-height:calc(100vh - 65px)}
.column{flex:1;min-width:280px;max-width:400px}
.column-header{font-size:13px;font-weight:600;text-transform:uppercase;letter-spacing:.5px;color:var(--text2);padding:8px 4px;display:flex;align-items:center;gap:8px;margin-bottom:12px}
.column-header .count{background:var(--border);border-radius:10px;padding:1px 8px;font-size:12px}
.card{background:var(--surface);border:1px solid var(--border);border-radius:8px;padding:14px;margin-bottom:10px;cursor:pointer;transition:all .15s ease;border-left:3px solid transparent}
.card:hover{border-color:var(--border);transform:translateY(-1px);box-shadow:0 4px 12px rgba(0,0,0,.3)}
.card.mining{border-left-color:var(--blue)}
.card.api-factory{border-left-color:var(--green)}
.card.infra{border-left-color:var(--purple)}
.card-title{font-size:14px;font-weight:600;margin-bottom:4px}
.card-desc{font-size:12px;color:var(--text2);margin-bottom:8px;line-height:1.4}
.card-meta{display:flex;justify-content:space-between;align-items:center;font-size:11px;color:var(--text2)}
.badge{font-size:10px;padding:2px 8px;border-radius:10px;font-weight:500;text-transform:uppercase;letter-spacing:.3px}
.badge.mining{background:rgba(31,111,235,.15);color:#58a6ff}
.badge.api-factory{background:rgba(35,134,54,.15);color:#3fb950}
.badge.infra{background:rgba(137,87,229,.15);color:#bc8cff}
.card-details{max-height:0;overflow:hidden;transition:max-height .3s ease;font-size:12px;color:var(--text2);line-height:1.6}
.card.expanded .card-details{max-height:300px;margin-top:10px;padding-top:10px;border-top:1px solid var(--border)}
.status-actions{display:flex;gap:6px;margin-top:8px}
.status-actions button{font-size:11px;padding:4px 10px;border-radius:6px;border:1px solid var(--border);background:var(--bg);color:var(--text2);cursor:pointer;transition:all .15s}
.status-actions button:hover{border-color:var(--blue);color:var(--text)}
.status-actions button.active{background:var(--blue);border-color:var(--blue);color:#fff}
@media(max-width:768px){.board{flex-direction:column;padding:12px}.column{max-width:100%}header{padding:12px 16px}}
</style>
</head>
<body>
<script>window.TASKS_DATA = {"tasks": [{"id": "a1", "title": "HotCopper scraper", "description": "Web scraper for HotCopper forum posts and announcements", "status": "done", "project": "mining", "created_at": "2026-02-07T10:00:00", "updated_at": "2026-02-07T14:00:00", "details": "Built scraper to pull forum posts from HotCopper. Handles pagination, rate limiting, and stores raw HTML for processing.", "sub_agent_id": null}, {"id": "a2", "title": "PDF classifier", "description": "ML classifier for ASX announcement PDF types", "status": "done", "project": "mining", "created_at": "2026-02-07T11:00:00", "updated_at": "2026-02-07T15:00:00", "details": "Classifies PDFs into categories: 5B, drill results, feasibility, capital raise, etc. Uses keyword matching and structure analysis.", "sub_agent_id": null}, {"id": "a3", "title": "Appendix 5B extractor", "description": "Extract quarterly cashflow data from Appendix 5B filings", "status": "done", "project": "mining", "created_at": "2026-02-07T12:00:00", "updated_at": "2026-02-07T16:00:00", "details": "Parses Appendix 5B PDFs to extract cash receipts, payments, and net cashflow figures into structured data.", "sub_agent_id": null}, {"id": "a4", "title": "Drill results extractor", "description": "Parse drill results from ASX announcements", "status": "done", "project": "mining", "created_at": "2026-02-07T13:00:00", "updated_at": "2026-02-07T17:00:00", "details": "Extracts drill hole IDs, depths, intercepts, and grades from announcement PDFs. Handles multiple table formats.", "sub_agent_id": null}, {"id": "a5", "title": "Feasibility study extractor", "description": "Extract key metrics from feasibility studies", "status": "done", "project": "mining", "created_at": "2026-02-07T14:00:00", "updated_at": "2026-02-08T10:00:00", "details": "Pulls NPV, IRR, AISC, mine life, capex and other key metrics from PFS/DFS/BFS documents.", "sub_agent_id": null}, {"id": "a6", "title": "Unified pipeline orchestrator", "description": "Orchestrates the full announcement processing pipeline", "status": "done", "project": "mining", "created_at": "2026-02-08T08:00:00", "updated_at": "2026-02-08T12:00:00", "details": "Coordinates download \u2192 classify \u2192 extract \u2192 store workflow. Handles retries, logging, and parallel processing.", "sub_agent_id": null}, {"id": "a7", "title": "SQLite database + schema", "description": "Database schema and ORM for all extracted data", "status": "done", "project": "mining", "created_at": "2026-02-08T09:00:00", "updated_at": "2026-02-08T13:00:00", "details": "SQLite DB with tables for announcements, extractions, tickers, prices. Includes migrations and query helpers.", "sub_agent_id": null}, {"id": "a8", "title": "Daily briefing generator + cron job", "description": "Automated daily briefing email/report generation", "status": "done", "project": "mining", "created_at": "2026-02-08T10:00:00", "updated_at": "2026-02-08T14:00:00", "details": "Generates daily summary of new announcements, price movements, and key events. Runs via cron at 7am AEST.", "sub_agent_id": null}, {"id": "a9", "title": "Price/volume tracker + impact scoring", "description": "Track price and volume changes with announcement impact correlation", "status": "done", "project": "mining", "created_at": "2026-02-08T11:00:00", "updated_at": "2026-02-08T15:00:00", "details": "Uses yfinance to track price/volume. Scores announcement impact by correlating price moves within 24-48h window.", "sub_agent_id": null}, {"id": "a10", "title": "Watchlist expansion (33 tickers)", "description": "Expanded watchlist from initial set to 33 ASX tickers", "status": "done", "project": "mining", "created_at": "2026-02-08T12:00:00", "updated_at": "2026-02-08T16:00:00", "details": "Curated watchlist of 33 ASX mining/exploration tickers based on market cap, activity, and sector coverage.", "sub_agent_id": null}, {"id": "a11", "title": "Briefing polish (dedup, filtering, formatting)", "description": "Improved briefing quality with deduplication and formatting", "status": "done", "project": "mining", "created_at": "2026-02-08T14:00:00", "updated_at": "2026-02-08T17:00:00", "details": "Added dedup logic, relevance filtering, and clean markdown formatting to daily briefings.", "sub_agent_id": null}, {"id": "b1", "title": "Bulk backfill", "description": "Backfill 3000 announcements across 33 tickers", "status": "done", "project": "mining", "created_at": "2026-02-08T16:00:00", "updated_at": "2026-02-08T17:14:00", "details": "300 announcements processed across TMS, MEK, SMI", "sub_agent_id": null}, {"id": "c1", "title": "Resource estimate (MRE) extractor", "description": "Extract JORC resource estimates from announcements", "status": "done", "project": "mining", "created_at": "2026-02-08T17:00:00", "updated_at": "2026-02-08T18:16:00", "details": "Built extract_mre.py \u2014 extracts tonnage, grades, classifications from resource tables. Tested on sample files, integrated into pipeline.", "sub_agent_id": null}, {"id": "c2", "title": "Capital raise extractor", "description": "Extract capital raise details from placement/SPP announcements", "status": "done", "project": "mining", "created_at": "2026-02-08T17:00:00", "updated_at": "2026-02-08T18:16:00", "details": "Built extract_capital_raise.py \u2014 7 key fields (price, shares, total, discount, use of funds, managers, type). Tested across 48 PDFs.", "sub_agent_id": null}, {"id": "c3", "title": "Appendix 3Y extractor", "description": "Extract director interest changes from Appendix 3Y filings", "status": "done", "project": "mining", "created_at": "2026-02-08T17:00:00", "updated_at": "2026-02-08T18:10:18.445319", "details": "Built extract_3y.py \u2014 14 fields, tested on 2 PDFs (West Wits, Many Peaks). Integrated into pipeline.", "sub_agent_id": null}, {"id": "c4", "title": "Company profile generator", "description": "Auto-generate company profiles from extracted data", "status": "in_progress", "project": "mining", "created_at": "2026-02-08T17:00:00", "updated_at": "2026-02-08T18:16:00", "details": "Sub-agent building profile generator \u2014 aggregates cash, drilling, resources, announcements per ticker.", "sub_agent_id": "agent:main:subagent:9ea5dce9-8bb8-47dc-8396-ce05a60da5bc"}, {"id": "c5", "title": "Reddit problem scraper", "description": "Scrape Reddit for common developer pain points and API ideas", "status": "done", "project": "api-factory", "created_at": "2026-02-08T17:00:00", "updated_at": "2026-02-08T21:00:00", "details": "Built reddit_scraper.py \u2014 scraped 7 subreddits (140 posts), scored pain signals, output ready for API Factory prioritization.", "sub_agent_id": null}, {"id": "c6", "title": "JSON formatter proof of concept", "description": "Build PoC for a hosted JSON formatting/validation API", "status": "done", "project": "api-factory", "created_at": "2026-02-08T17:00:00", "updated_at": "2026-02-08T21:00:00", "details": "Built FastAPI app with format/validate/minify/transform endpoints, HTML UI, all tests passing.", "sub_agent_id": null}, {"id": "c7", "title": "Pi security hardening", "description": "Firewall, SSH hardening, disable rpcbind", "status": "done", "project": "infra", "created_at": "2026-02-08T17:00:00", "updated_at": "2026-02-08T20:52:00", "details": "Configured UFW firewall, hardened SSH, disabled rpcbind. Security audit complete.", "sub_agent_id": null}]};</script>
<header>
  <h1>ðŸ“‹ Task Board</h1>
  <div class="stats" id="stats"></div>
</header>
<div class="board" id="board"></div>
<script>
const COLS = [
  {key:'todo', label:'To Do'},
  {key:'in_progress', label:'In Progress'},
  {key:'done', label:'Done'}
];

let tasks = [];

async function load() {
  if (window.TASKS_DATA) {
    tasks = window.TASKS_DATA.tasks;
    render();
    return;
  }
  const r = await fetch('/api/tasks');
  const d = await r.json();
  tasks = d.tasks;
  render();
}

function fmtDate(s) {
  if (!s) return '';
  const d = new Date(s);
  return d.toLocaleDateString('en-AU',{day:'numeric',month:'short'}) + ' ' + d.toLocaleTimeString('en-AU',{hour:'2-digit',minute:'2-digit',hour12:false});
}

async function moveTask(id, status) {
  await fetch(`/api/tasks/${id}`, {method:'PATCH', headers:{'Content-Type':'application/json'}, body:JSON.stringify({status})});
  await load();
}

function render() {
  const board = document.getElementById('board');
  const stats = document.getElementById('stats');
  const counts = {};
  COLS.forEach(c => counts[c.key] = 0);
  tasks.forEach(t => counts[t.status] = (counts[t.status]||0)+1);
  stats.innerHTML = `<span><span class="dot" style="background:var(--orange)"></span>${counts.todo||0} todo</span><span><span class="dot" style="background:var(--blue)"></span>${counts.in_progress||0} active</span><span><span class="dot" style="background:var(--green)"></span>${counts.done||0} done</span>`;

  board.innerHTML = COLS.map(col => {
    const items = tasks.filter(t => t.status === col.key);
    return `<div class="column"><div class="column-header">${col.label}<span class="count">${items.length}</span></div>${items.map(t => `
      <div class="card ${t.project}" onclick="this.classList.toggle('expanded')" data-id="${t.id}">
        <div class="card-title">${esc(t.title)}</div>
        <div class="card-desc">${esc(t.description)}</div>
        <div class="card-meta"><span class="badge ${t.project}">${t.project}</span><span>${fmtDate(t.updated_at)}</span></div>
        <div class="card-details">
          <p>${esc(t.details||'No details yet.')}</p>
          ${t.sub_agent_id ? `<p style="margin-top:6px">ðŸ¤– Agent: ${esc(t.sub_agent_id)}</p>` : ''}
          <div class="status-actions">
            ${COLS.map(c=>`<button class="${t.status===c.key?'active':''}" onclick="event.stopPropagation();moveTask('${t.id}','${c.key}')">${c.label}</button>`).join('')}
          </div>
        </div>
      </div>`).join('')}</div>`;
  }).join('');
}

function esc(s){const d=document.createElement('div');d.textContent=s;return d.innerHTML}
load();
if (!window.TASKS_DATA) setInterval(load, 30000);
</script>
</body>
</html>
